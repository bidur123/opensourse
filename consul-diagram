<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" modified="2024-06-09T00:00:00.000Z" version="21.0.0">
  <diagram name="Consul-Rancher-Architecture" id="consul-rancher">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1200" pageHeight="900" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        
        <!-- Title -->
        <mxCell id="title" value="HashiCorp Consul in Rancher Kubernetes Cluster - Worker Node Deployment" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="300" y="10" width="600" height="30" as="geometry"/>
        </mxCell>
        
        <!-- Rancher Management Layer Container -->
        <mxCell id="rancher-container" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#2196F3;strokeWidth=2;dashed=0;" vertex="1" parent="1">
          <mxGeometry x="50" y="60" width="1100" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="rancher-title" value="Rancher Management Layer" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#1976D2;" vertex="1" parent="1">
          <mxGeometry x="70" y="70" width="200" height="20" as="geometry"/>
        </mxCell>
        
        <!-- Rancher Server -->
        <mxCell id="rancher-server" value="Rancher Server&#xa;Cluster Management&#xa;UI/API Gateway" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2196F3;strokeColor=#1976D2;fontColor=#FFFFFF;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="100" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Rancher Agent -->
        <mxCell id="rancher-agent" value="Rancher Agent&#xa;Node Registration&#xa;Monitoring" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#42A5F5;strokeColor=#1976D2;fontColor=#FFFFFF;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="320" y="100" width="150" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Kubernetes Cluster Container -->
        <mxCell id="k8s-container" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E8;strokeColor=#4CAF50;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="50" y="200" width="1100" height="680" as="geometry"/>
        </mxCell>
        
        <mxCell id="k8s-title" value="Kubernetes Cluster (Rancher Managed)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#388E3C;" vertex="1" parent="1">
          <mxGeometry x="70" y="210" width="300" height="20" as="geometry"/>
        </mxCell>
        
        <!-- Master Nodes Container -->
        <mxCell id="master-container" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#2196F3;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="250" width="1040" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="master-title" value="Master Nodes (Control Plane - Untouched)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#1976D2;" vertex="1" parent="1">
          <mxGeometry x="90" y="260" width="300" height="20" as="geometry"/>
        </mxCell>
        
        <!-- Master Node 1 -->
        <mxCell id="master-1" value="Master Node 1&#xa;API Server, etcd&#xa;Controller, Scheduler" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#2196F3;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="100" y="285" width="150" height="70" as="geometry"/>
        </mxCell>
        
        <!-- Master Node 2 -->
        <mxCell id="master-2" value="Master Node 2&#xa;API Server, etcd&#xa;Controller, Scheduler" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#2196F3;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="270" y="285" width="150" height="70" as="geometry"/>
        </mxCell>
        
        <!-- Master Node 3 -->
        <mxCell id="master-3" value="Master Node 3&#xa;API Server, etcd&#xa;Controller, Scheduler" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#2196F3;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="440" y="285" width="150" height="70" as="geometry"/>
        </mxCell>
        
        <!-- Worker Nodes Container -->
        <mxCell id="worker-container" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F1F8E9;strokeColor=#8BC34A;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="390" width="1040" height="470" as="geometry"/>
        </mxCell>
        
        <mxCell id="worker-title" value="Worker Nodes" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#689F38;" vertex="1" parent="1">
          <mxGeometry x="90" y="400" width="100" height="20" as="geometry"/>
        </mxCell>
        
        <!-- Consul Server Nodes Container -->
        <mxCell id="consul-server-container" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE4EC;strokeColor=#E91E63;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="100" y="425" width="1000" height="180" as="geometry"/>
        </mxCell>
        
        <mxCell id="consul-server-title" value="Dedicated Consul Server Nodes" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1;fontColor=#C2185B;" vertex="1" parent="1">
          <mxGeometry x="110" y="435" width="200" height="20" as="geometry"/>
        </mxCell>
        
        <!-- Consul Server Node 1 -->
        <mxCell id="consul-server-1" value="Worker Node 1&#xa;(Consul Server)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#E91E63;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="120" y="455" width="200" height="140" as="geometry"/>
        </mxCell>
        
        <mxCell id="consul-server-pod-1" value="Consul Server Pod&#xa;Leader/Follower&#xa;Raft Consensus" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E91E63;strokeColor=#C2185B;fontColor=#FFFFFF;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="130" y="500" width="180" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="server-label-1" value="consul-server: &quot;true&quot;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFEB3B;strokeColor=#FBC02D;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="130" y="550" width="180" height="25" as="geometry"/>
        </mxCell>
        
        <!-- Consul Server Node 2 -->
        <mxCell id="consul-server-2" value="Worker Node 2&#xa;(Consul Server)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#E91E63;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="340" y="455" width="200" height="140" as="geometry"/>
        </mxCell>
        
        <mxCell id="consul-server-pod-2" value="Consul Server Pod&#xa;Leader/Follower&#xa;Raft Consensus" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E91E63;strokeColor=#C2185B;fontColor=#FFFFFF;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="350" y="500" width="180" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="server-label-2" value="consul-server: &quot;true&quot;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFEB3B;strokeColor=#FBC02D;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="350" y="550" width="180" height="25" as="geometry"/>
        </mxCell>
        
        <!-- Consul Server Node 3 -->
        <mxCell id="consul-server-3" value="Worker Node 3&#xa;(Consul Server)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#E91E63;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="560" y="455" width="200" height="140" as="geometry"/>
        </mxCell>
        
        <mxCell id="consul-server-pod-3" value="Consul Server Pod&#xa;Leader/Follower&#xa;Raft Consensus" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E91E63;strokeColor=#C2185B;fontColor=#FFFFFF;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="570" y="500" width="180" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="server-label-3" value="consul-server: &quot;true&quot;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFEB3B;strokeColor=#FBC02D;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="570" y="550" width="180" height="25" as="geometry"/>
        </mxCell>
        
        <!-- Consul UI Node -->
        <mxCell id="consul-ui-node" value="Worker Node 4&#xa;(Consul UI)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#9C27B0;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="780" y="455" width="160" height="140" as="geometry"/>
        </mxCell>
        
        <mxCell id="consul-ui-pod" value="Consul UI Pod&#xa;Web Interface&#xa;LoadBalancer Svc" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9C27B0;strokeColor=#7B1FA2;fontColor=#FFFFFF;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="790" y="500" width="140" height="40" as="geometry"/>
        </mxCell>
        
        <!-- Application Worker Nodes Container -->
        <mxCell id="app-worker-container" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#9C27B0;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="625" width="1000" height="220" as="geometry"/>
        </mxCell>
        
        <mxCell id="app-worker-title" value="Application Worker Nodes" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1;fontColor=#7B1FA2;" vertex="1" parent="1">
          <mxGeometry x="110" y="635" width="200" height="20" as="geometry"/>
        </mxCell>
        
        <!-- App Worker Node 1 -->
        <mxCell id="app-worker-1" value="Worker Node 5" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#4CAF50;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="120" y="655" width="180" height="180" as="geometry"/>
        </mxCell>
        
        <mxCell id="consul-client-1" value="Consul Client (DaemonSet)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E91E63;strokeColor=#C2185B;fontColor=#FFFFFF;fontSize=9;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="130" y="685" width="160" height="25" as="geometry"/>
        </mxCell>
        
        <mxCell id="app-pod-1" value="App Pod 1&#xa;Service A&#xa;+ Envoy&#xa;Sidecar" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#81C784;strokeColor=#4CAF50;fontSize=8;" vertex="1" parent="1">
          <mxGeometry x="130" y="720" width="70" height="55" as="geometry"/>
        </mxCell>
        
        <mxCell id="app-pod-2" value="App Pod 2&#xa;Service B&#xa;+ Envoy&#xa;Sidecar" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#81C784;strokeColor=#4CAF50;fontSize=8;" vertex="1" parent="1">
          <mxGeometry x="210" y="720" width="70" height="55" as="geometry"/>
        </mxCell>
        
        <mxCell id="client-label-1" value="consul-client: &quot;true&quot;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFEB3B;strokeColor=#FBC02D;fontSize=8;" vertex="1" parent="1">
          <mxGeometry x="130" y="810" width="160" height="18" as="geometry"/>
        </mxCell>
        
        <!-- App Worker Node 2 -->
        <mxCell id="app-worker-2" value="Worker Node 6" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#4CAF50;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="320" y="655" width="180" height="180" as="geometry"/>
        </mxCell>
        
        <mxCell id="consul-client-2" value="Consul Client (DaemonSet)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E91E63;strokeColor=#C2185B;fontColor=#FFFFFF;fontSize=9;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="330" y="685" width="160" height="25" as="geometry"/>
        </mxCell>
        
        <mxCell id="app-pod-3" value="App Pod 3&#xa;Service C&#xa;+ Envoy&#xa;Sidecar" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#81C784;strokeColor=#4CAF50;fontSize=8;" vertex="1" parent="1">
          <mxGeometry x="330" y="720" width="70" height="55" as="geometry"/>
        </mxCell>
        
        <mxCell id="app-pod-4" value="App Pod 4&#xa;Service D&#xa;+ Envoy&#xa;Sidecar" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#81C784;strokeColor=#4CAF50;fontSize=8;" vertex="1" parent="1">
          <mxGeometry x="410" y="720" width="70" height="55" as="geometry"/>
        </mxCell>
        
        <mxCell id="client-label-2" value="consul-client: &quot;true&quot;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFEB3B;strokeColor=#FBC02D;fontSize=8;" vertex="1" parent="1">
          <mxGeometry x="330" y="810" width="160" height="18" as="geometry"/>
        </mxCell>
        
        <!-- App Worker Node 3 -->
        <mxCell id="app-worker-3" value="Worker Node 7" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#4CAF50;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="520" y="655" width="180" height="180" as="geometry"/>
        </mxCell>
        
        <mxCell id="consul-client-3" value="Consul Client (DaemonSet)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E91E63;strokeColor=#C2185B;fontColor=#FFFFFF;fontSize=9;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="530" y="685" width="160" height="25" as="geometry"/>
        </mxCell>
        
        <mxCell id="app-pod-5" value="App Pod 5&#xa;Service E&#xa;+ Envoy&#xa;Sidecar" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#81C784;strokeColor=#4CAF50;fontSize=8;" vertex="1" parent="1">
          <mxGeometry x="530" y="720" width="70" height="55" as="geometry"/>
        </mxCell>
        
        <mxCell id="app-pod-6" value="App Pod 6&#xa;Service F&#xa;+ Envoy&#xa;Sidecar" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#81C784;strokeColor=#4CAF50;fontSize=8;" vertex="1" parent="1">
          <mxGeometry x="610" y="720" width="70" height="55" as="geometry"/>
        </mxCell>
        
        <mxCell id="client-label-3" value="consul-client: &quot;true&quot;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFEB3B;strokeColor=#FBC02D;fontSize=8;" vertex="1" parent="1">
          <mxGeometry x="530" y="810" width="160" height="18" as="geometry"/>
        </mxCell>
        
        <!-- External Access -->
        <mxCell id="external-access" value="External Access&#xa;Load Balancer&#xa;Ingress Controller&#xa;Monitoring&#xa;Logging" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#FF9800;fontSize=10;fontStyle=1;fontColor=#E65100;" vertex="1" parent="1">
          <mxGeometry x="720" y="655" width="160" height="100" as="geometry"/>
        </mxCell>
        
        <!-- Deployment Strategy Box -->
        <mxCell id="deployment-strategy" value="Deployment Strategy&#xa;&#xa;Node Selectors:&#xa;• consul-server: &quot;true&quot;&#xa;• consul-client: &quot;true&quot;&#xa;&#xa;Taints &amp; Tolerations:&#xa;• Dedicated server nodes&#xa;• Prevent app scheduling&#xa;&#xa;StatefulSet:&#xa;• Persistent volumes&#xa;• Stable network identity" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#FF5722;fontSize=9;align=left;verticalAlign=top;fontColor=#BF360C;" vertex="1" parent="1">
          <mxGeometry x="900" y="655" width="190" height="180" as="geometry"/>
        </mxCell>
        
        <!-- Connections -->
        <!-- Rancher to K8s -->
        <mxCell id="rancher-k8s-conn" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#2196F3;strokeWidth=2;" edge="1" parent="1" source="rancher-agent" target="k8s-title">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="395" y="160" as="sourcePoint"/>
            <mxPoint x="340" y="210" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        
        <!-- Consul Server Cluster Communication -->
        <mxCell id="raft-1-2" value="Raft Protocol" style="endArrow=none;html=1;rounded=0;strokeColor=#E91E63;strokeWidth=2;fontSize=8;fontColor=#C2185B;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="320" y="520" as="sourcePoint"/>
            <mxPoint x="350" y="520" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="raft-2-3" value="" style="endArrow=none;html=1;rounded=0;strokeColor=#E91E63;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="540" y="520" as="sourcePoint"/>
            <mxPoint x="570" y="520" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        
        <!-- Client to Server Communication -->
        <mxCell id="client-server-1" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#E91E63;strokeWidth=2;dashed=1;dashPattern=5 5;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="210" y="685" as="sourcePoint"/>
            <mxPoint x="220" y="540" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="client-server-2" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#E91E63;strokeWidth=2;dashed=1;dashPattern=5 5;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="410" y="685" as="sourcePoint"/>
            <mxPoint x="440" y="540" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="client-server-3" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#E91E63;strokeWidth=2;dashed=1;dashPattern=5 5;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="610" y="685" as="sourcePoint"/>
            <mxPoint x="660" y="540" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        
        <!-- UI to Server Communication -->
        <mxCell id="ui-server-conn" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#9C27B0;strokeWidth=2;dashed=1;dashPattern=3 3;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="790" y="520" as="sourcePoint"/>
            <mxPoint x="750" y="520" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
